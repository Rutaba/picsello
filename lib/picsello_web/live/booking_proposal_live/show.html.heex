<%= if @proposal do %>
  <%= if show_booking_countdown?(@job) do %>
    <div class="bg-black text-white flex py-4 px-20 items-center justify-center text-lg font-semibold">
      <.icon name="clock" class="w-7 h-7 text-white" />
      <span class="mt-1 ml-2 text-center">Your booking reservation expires in <%= @booking_countdown |> Time.from_seconds_after_midnight() |> Calendar.strftime("%-M:%S") %> minutes!</span>
    </div>
  <% end %>
  <div class="center-container px-8 pt-6 mx-auto min-h-screen flex flex-col">
    <div class="flex">
      <.photographer_logo organization={@organization} />
    </div>
    <hr class="border-gray-100 my-8">

    <h2 class="text-2xl md:mt-12">
      <%= if PaymentSchedules.all_paid?(@job) do %>
        <span class="capitalize"><%= @job.client.name %></span>, your shoot has been booked!
      <% else %>
        <span class="capitalize"><%= @job.client.name %></span>, let's get your shoot booked!
      <% end %>
    </h2>

    <div class="grid md:grid-cols-2 gap-5">
      <div class="md:mr-24">
        <p class="whitespace-pre-line">
          <%= if PaymentSchedules.all_paid?(@job) do %>
            Thank you <%= @job.client.name %>,

            Your session fee has been paid in full. We are looking forward to capturing this most special day for you.

            Thank you for choosing <%= @organization.name %>.
          <% else %>
            Please note that your session will be considered officially booked once you accept the proposal, review and sign the contract, complete the questionnaire, and make payment.

            Once your payment has been confirmed, your session is booked for you exclusively and any other client inquiries will be declined. You will receive a payment confirmation email and additional emails about your session leading up to the shoot.

            I look forward to capturing these memories for you and greatly
            appreciate your business.

            <span><%= @organization.name %></span>
          <% end %>
        </p>
        <hr class="border-gray-100 my-8">
        <h3 class="uppercase text-base-250">Have Questions?</h3>
        <a class="block mt-2 btn-primary w-max" phx-click="open-compose">Message <%= @organization.name %></a>
      </div>
      <div class="md:border md:border-gray-100 sm:px-10 lg:px-20 py-12">
        <%= if @job.booking_event do %>
          <div class="p-3 bg-base-200 mb-8">
            <p class="font-bold"><%= @job.booking_event.name %></p>
            <p><%= Picsello.Package.price(@package) %></p>
            <.subtitle_display booking_event={@job.booking_event} package={@package} class="mt-0" />
            <div class="mt-1 flex flex-col">
              <.date_display date={formatted_date(@job, @photographer)} />
              <.address_display booking_event={@job.booking_event} class="mt-1" />
            </div>
          </div>
        <% end %>
        <h3 class="text-3xl md:mr-20">To officially book your session:</h3>

        <%= unless Job.imported?(@job) do %>
          <button title="Proposal" type="button" phx-click="open-details" class="mt-6 font-semibold btn-row">
            <div class="flex flex-col items-start w-full font-medium">
              <%= if @proposal.accepted_at do %>
                <.badge class="mb-1" color={:gray} mode={:outlined}>Completed</.badge>
              <% else %>
                <.badge class="mb-1" color={:red} mode={:outlined}>To-Do</.badge>
              <% end %>
              <div class="flex items-center justify-between w-full font-light">
                Review and accept your proposal
                <.icon name="forth" class="stroke-2 stroke-current h-4 w-4" />
              </div>
            </div>
          </button>

          <button title="Contract" type="button" phx-click="open-contract" class="mt-6 font-semibold btn-row">
            <div class="flex flex-col items-start w-full font-medium">
              <%= if @proposal.signed_at do %>
                <.badge class="mb-1" color={:gray} mode={:outlined}>Completed</.badge>
              <% else %>
                <.badge class="mb-1" color={:red} mode={:outlined}>To-Do</.badge>
              <% end %>
              <div class="flex items-center justify-between w-full font-light">
                Review and sign your contract
                <.icon name="forth" class="stroke-2 stroke-current h-4 w-4" />
              </div>
            </div>
          </button>

          <%= if @proposal.questionnaire_id do %>
            <button title="Questionnaire" type="button" phx-click="open-questionnaire" class="mt-6 font-semibold btn-row">
              <div class="flex flex-col items-start w-full font-medium">
                <%= if @answer do %>
                  <.badge class="mb-1" color={:gray} mode={:outlined}>Completed</.badge>
                <% else %>
                  <.badge class="mb-1" color={:red} mode={:outlined}>To-Do</.badge>
                <% end %>
                <div class="flex items-center justify-between w-full font-light">
                  Fill out the initial questionnaire
                  <.icon name="forth" class="stroke-2 stroke-current h-4 w-4" />
                </div>
              </div>
            </button>
          <% end %>
        <% end %>

        <button title="Invoice" type="button" {if invoice_disabled?(@proposal, @stripe_status), do: %{}, else: %{phx_click: "open-invoice"}} class={classes("mt-6 font-semibold btn-row", %{"cursor-not-allowed opacity-25" => invoice_disabled?(@proposal, @stripe_status)})} disabled={invoice_disabled?(@proposal, @stripe_status)}>
          <div class="flex flex-col items-start w-full font-medium">
            <%= cond do %>
              <% PaymentSchedules.is_with_cash?(@job) && @next_due_payment && DateTime.compare(DateTime.utc_now(), @next_due_payment |> Map.get(:due_at)) in [:eq, :gt] -> %>
                <.badge class="mb-1" color={:red} mode={:outlined}>Pending offline payment</.badge>
              <% PaymentSchedules.all_paid?(@job) -> %>
                <.badge class="mb-1" color={:gray} mode={:outlined}>Completed</.badge>
              <% true -> %>
                <.badge class="mb-1" color={:red} mode={:outlined}><%= pending_amount_details(@job) %></.badge>
            <% end %>
            <div class="flex items-center justify-between w-full font-light">
              Make payment
              <.icon name="forth" class="stroke-2 w-4 h-4 stroke-current"/>
            </div>
            <%= if PaymentSchedules.payment_schedules_count(@job) > 1 do %>
            <hr class="w-full mt-3">
              <a {testid("show-schedule")} {if invoice_disabled?(@proposal, @stripe_status), do: %{}, else: %{phx_click: "open_schedule_popup"}} class="mt-3 text-base-250 underline underline-offset-2 font-normal schedule-popup-link" disabled={invoice_disabled?(@proposal, @stripe_status)}>Show schedule</a>
            <% end %>
          </div>
        </button>
      </div>
    </div>
    <.profile_footer color={@color} photographer={@photographer} organization={@organization} />
  </div>
<% end %>
